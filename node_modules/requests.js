var Player    = require('../public/player');
var responses = require('responses');

module.exports = {
  createLocalPlayer : function(simulation , message) {
    var player = simulation.addPlayer(message);
    
    simulation.sendTo(message.id , new responses['createLocalPlayer'](player));
    simulation.sendToAllExcept(message.id , new responses['createPlayer'](player));
  },
  
  velocityUpdate : function(simulation , message) {
    var player = simulation.findPlayerById(message.id);
    
    if (player.setPosition(message.velocity)) {
      simulation.sendToAllExcept(message.id , new responses['velocityUpdate'](message.id , message.velocity));
    }
  },
  
  positionUpdate : function(simulation , message) {
    var player = simulation.findPlayerById(message.id);

    if (player.setPosition(message.position)) {
      simulation.sendToAllExcept(message.id , new responses['positionUpdate'](message.id , message.position));
    }
  },
  
  angularVelocityUpdate : function(simulation , message) {
    var player = simulation.findPlayerById(message.id);
    
    if (player.setAngularVelocity(message.angularVelocity)) {
      simulation.sendToAllExcept(message.id , new responses['angularVelocityUpdate'](message.id , message.angularVelocity));
    }
  },
  
  angleUpdate : function(simulation , message) {
    var player = simulation.findPlayerById(message.id);
    
    if (player.setAngle(message.angle)) {
      simulation.sendToAllExcept(message.id , new responses['angleUpdate'](message.id , message.angle));
    }
  },
  
  fetchGroundTiles : function(simulation , message) {
    simulation.world.groundTiles.each(function(tile) {
      simulation.sendTo(message.id , new responses['fetchGroundTile'](tile));
    });
    
    simulation.sendTo(message.id , new responses['noMoreGroundTiles']());
  },
  
  fetchOtherPlayers : function(simulation , message) {
    simulation.eachPlayer(function(player) {
      if (player.id !== message.id) {
        simulation.sendTo(message.id , new responses['createPlayer'](player));
      }
    });
    
    simulation.sendTo(message.id , new responses['noMorePlayers']());
  }
}